var Zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eu(re){return re&&re.__esModule&&Object.prototype.hasOwnProperty.call(re,"default")?re.default:re}var or={exports:{}};(function(re,Yo){(function(Ie,Q){re.exports=Q()})(self,()=>(()=>{var me={};me.d=(e,n)=>{for(var t in n)me.o(n,t)&&!me.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},me.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var Ie={};me.d(Ie,{default:()=>er});function Q(e){"@babel/helpers - typeof";return Q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Q(e)}function ur(e,n){if(Q(e)!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var r=t.call(e,n||"default");if(Q(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Xt(e){var n=ur(e,"string");return Q(n)=="symbol"?n:n+""}function y(e,n,t){return n=Xt(n),n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Qt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?Qt(Object(t),!0).forEach(function(r){y(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Qt(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function sr(e,n){if(e==null)return{};var t={},r=Object.keys(e),a,i;for(i=0;i<r.length;i++)a=r[i],!(n.indexOf(a)>=0)&&(t[a]=e[a]);return t}function cr(e,n){if(e==null)return{};var t=sr(e,n),r,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],!(n.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var ve=1e3,mt=ve*60,Yt=mt*60,Zt=Yt*24,G=function(e){return e.REASON_GENERAL="general",e.REASON_GDPR="gdpr",e}({}),vt={TRANSACTION_ERROR:"XHR transaction failed due to an error",SERVER_MALFORMED_RESPONSE:"Response from server is malformed",SERVER_INTERNAL_ERROR:"Internal error occurred on the server",SERVER_CANNOT_PROCESS:"Server was not able to process the request, probably due to error coming from the client",NO_CONNECTION:"No internet connectivity",SKIP:"Skipping slower attempt",MISSING_URL:"Url is not provided"},ge=function(e){return e.NO_STORAGE="noStorage",e.INDEXED_DB="indexedDB",e.LOCAL_STORAGE="localStorage",e}({}),lr={default:"adjust.com",india:"adjust.net.in",china:"adjust.world",world:"adjust.world",EU:"eu.adjust.com",TR:"tr.adjust.com",US:"us.adjust.com"},fr="https://app.",dr="https://gdpr.",en="https://",De={WEB_UUID_CREATED:"activity:web_uuid",ATTRIBUTION_RECEIVED:"activity:attribution"};function mr(e){if(Array.isArray(e))return e}function vr(e,n){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r,a,i,o,u=[],s=!0,c=!1;try{if(i=(t=t.call(e)).next,n===0){if(Object(t)!==t)return;s=!1}else for(;!(s=(r=i.call(t)).done)&&(u.push(r.value),u.length!==n);s=!0);}catch(l){c=!0,a=l}finally{try{if(!s&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw a}}return u}}function gt(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function pt(e,n){if(e){if(typeof e=="string")return gt(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return gt(e,n)}}function gr(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function b(e,n){return mr(e)||vr(e,n)||pt(e,n)||gr()}function pr(e){if(!e.length)return"";if(e.length===1)return"".concat(e[0]);var n=e.length-1,t=e.slice(0,n).join(", ");return"".concat(t," and ").concat(e[n])}function Y(e){return!Object.keys(e).length&&e.constructor===Object}function pe(e){return Q(e)==="object"&&e!==null&&!(e instanceof Array)}function tn(e){try{var n=JSON.parse(e);return pe(n)}catch(t){return!1}}function nn(e,n,t){function r(i){return Array.isArray(n)?n.every(function(o){return i[o]===t[o]}):i[n]===t}for(var a=0;a<e.length;a+=1)if(r(e[a]))return a;return-1}function ae(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return e.reduce(function(n,t){return d(d({},n),{},y({},t.key,t.value))},{})}function rn(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.filter(function(t){return n.indexOf(t)!==-1})}function ee(e,n){var t=new RegExp("\\/".concat(n,"(\\/.*|\\?.*){0,1}$"));return t.test(e)}function A(e,n){var t=b(n,2),r=t[0],a=t[1];return d(d({},e),{},y({},r,a))}function O(e){return Object.keys(e).map(function(n){return[n,e[n]]})}function Ee(e){return Object.keys(e).map(function(n){return e[n]})}function ht(e){return pe(e)?!Y(e):!!e||e===0}function an(){try{var e=new Date().toString(),n=window.localStorage;n.setItem(e,e);var t=n.getItem(e)===e;n.removeItem(e);var r=!!(t&&n);return r}catch(a){return!1}}var hr={namespace:"adjust-sdk",version:"5.7.0",env:"production"};const ie=hr;var yr="none",yt="error",on="warning",un="info",Ge="verbose",bt=y(y(y(y(y({},yr,-1),yt,0),on,1),un,2),Ge,3),br={log:"  ",info:" ",warn:" ",error:""},_r={development:Ge,production:yt,test:Ge},_t=sn(),Ke="";function sn(){return _r[ie.env]}function Sr(e,n){var t=!e||Object.keys(bt).indexOf(e)!==-1;if(!t){St("error","error","You must set one of the available log levels: verbose, info, warning, error or none");return}_t=e||sn(),Ke=n||Ke,St("info",e,"Log level set to ".concat(_t))}function St(e,n){var t;if(!(bt[_t]<bt[n])){for(var r=new Date().toISOString(),a=br[e],i=["[".concat(ie.namespace,"]"),r,"".concat(e.toUpperCase(),":").concat(a)],o=Ke?document.querySelector(Ke):null,u=arguments.length,s=new Array(u>2?u-2:0),c=2;c<u;c++)s[c-2]=arguments[c];(t=console)[e].apply(t,i.concat(s)),o&&(o.textContent+="".concat(i.join(" ")," ").concat(s.map(function(l){return pe(l)?JSON.stringify(l):l}).join(" "),"\n"),o.scrollTop=o.scrollHeight)}}function We(e,n){return function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];St.apply(void 0,[e,n].concat(r))}}var kr={setLogLevel:Sr,log:We("log",Ge),info:We("info",un),warn:We("warn",on),error:We("error",yt)};const f=kr;var he=null,Ve=null,kt=["appToken","environment"],Pr=[].concat(kt,["defaultTracker","externalDeviceId"]),wr=["customUrl","dataResidency","urlStrategy","eventDeduplicationListLimit","namespace"];function Ir(){return kt.reduce(function(e,n){return e&&!!he&&!!he[n]},!0)}function Dr(e){cn(e)||(he=Pr.filter(function(n){return!!e[n]}).map(function(n){return[n,e[n]]}).reduce(function(n,t){return A(n,t)},{}),Ve=wr.filter(function(n){return!!e[n]}).map(function(n){return[n,e[n]]}).reduce(A,{}))}function Er(){return he?d({},he):{}}function Or(){return Ve?d({},Ve):{}}function cn(e){var n=kt.filter(function(t){return!e[t]});return n.length?(f.error("You must define ".concat(pr(n))),!0):!1}function Rr(){he=null,Ve=null}var Ar={sessionWindow:30*mt,sessionTimerWindow:60*ve,requestValidityWindow:28*Zt,set:Dr,getBaseParams:Er,getCustomConfig:Or,isInitialised:Ir,hasMissing:cn,destroy:Rr};const N=Ar;var ln=function(e){return e.Queue="queue",e.ActivityState="activityState",e.GlobalParams="globalParams",e.EventDeduplication="eventDeduplication",e}(ln||{}),oe=function(e){return e.Queue="q",e.ActivityState="as",e.GlobalParams="gp",e.EventDeduplication="ed",e}(oe||{}),Oe=function(e){return e.Preferences="p",e}(Oe||{}),Cr={keyPath:"timestamp",autoIncrement:!1,fields:{url:{key:"u",values:{"/session":1,"/event":2,"/gdpr_forget_device":3,"/sdk_click":4,"/disable_third_party_sharing":5}},method:{key:"m",values:{GET:1,POST:2,PUT:3,DELETE:4}},timestamp:"t",createdAt:"ca",params:{key:"p",keys:{timeSpent:"ts",sessionLength:"sl",sessionCount:"sc",eventCount:"ec",lastInterval:"li",eventToken:"et",revenue:"re",currency:"cu",callbackParams:"cp",partnerParams:"pp"}}}},xr={keyPath:"uuid",autoIncrement:!1,fields:{uuid:{key:"u",values:{unknown:"-"}},timeSpent:"ts",sessionLength:"sl",sessionCount:"sc",eventCount:"ec",lastActive:"la",lastInterval:"li",installed:{key:"in",values:{false:0,true:1}},attribution:{key:"at",keys:{adid:"a",tracker_token:"tt",tracker_name:"tn",network:"nt",campaign:"cm",adgroup:"ag",creative:"cr",click_label:"cl",state:{key:"st",values:{installed:1,reattributed:2}}}}}},Nr={keyPath:"keyType",autoIncrement:!1,index:"type",fields:{keyType:{key:"kt",composite:["key","type"]},key:"k",value:"v",type:{key:"t",values:{callback:1,partner:2}}}},Tr={keyPath:"internalId",autoIncrement:!0,fields:{internalId:"ii",id:"i"}},jr={fields:{thirdPartySharingDisabled:{key:"td",keys:{reason:{key:"r",values:y({},G.REASON_GENERAL,1)},pending:{key:"p",values:{false:0,true:1}}}},sdkDisabled:{key:"sd",keys:{reason:{key:"r",values:y(y({},G.REASON_GENERAL,1),G.REASON_GDPR,2)},pending:{key:"p",values:{false:0,true:1}}}}}},Br={queue:{name:oe.Queue,scheme:Cr},activityState:{name:oe.ActivityState,scheme:xr},globalParams:{name:oe.GlobalParams,scheme:Nr},eventDeduplication:{name:oe.EventDeduplication,scheme:Tr},preferences:{name:Oe.Preferences,scheme:jr,permanent:!0}};function He(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"values")}function fn(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"keys")}function ze(e){return!!e&&Object.prototype.hasOwnProperty.call(e,"composite")}function Pt(e){return!!e&&typeof e!="string"}const Re=Br;function Ur(e){try{return JSON.parse(e)}catch(n){return e}}function Lr(e){return O(e).map(function(n){var t=b(n,2),r=t[0],a=t[1];return[a,Ur(r)]}).reduce(A,{})}function Fr(e){var n=O(e).map(function(t){var r=b(t,2),a=r[0],i=r[1],o={name:a,permanent:i.permanent};return[i.name,o]});return n.reduce(A,{})}function Mr(e,n,t){var r=He(t)?{values:Lr(t.values)}:{},a=fn(t)?{keys:dn(e,t.keys)}:{},i=ze(t)?{composite:t.composite.map(function(o){return wt(e,o)})}:{};return d(d(d({key:n},r),a),i)}function dn(e,n){return O(n).map(function(t){var r=b(t,2),a=r[0],i=r[1];return Pt(i)?[i.key,Mr(e,a,i)]:[i,a]}).reduce(A,{})}function qr(){var e=O(Re).map(function(n){var t=b(n,2),r=t[0],a=t[1],i={keyPath:a.scheme.keyPath,autoIncrement:a.scheme.autoIncrement,index:a.scheme.index,fields:a.scheme.fields};return[r,i]});return e.reduce(A,{})}function Gr(){var e=O(mn).map(function(n){var t=b(n,2),r=t[0],a=t[1],i={keyPath:wt(r,a.keyPath),autoIncrement:a.autoIncrement,index:wt(r,a.index),fields:dn(r,a.fields)};return[r,i]});return e.reduce(A,{})}function Kr(){return O(Re).reduce(function(e,n){var t=b(n,2),r=t[1];return e.concat(r.scheme.fields)},[]).map(function(e){return Ee(e).filter(He).map(function(n){return O(n.values)}).reduce(function(n,t){return n.concat(t)},[])}).reduce(function(e,n){return e.concat(n)},[]).reduce(A,{})}function wt(e,n){if(n){var t=Re[e].scheme.fields[n];return Pt(t)?t.key:t||n}}function Wr(){var e=O(Re).map(function(n){var t=b(n,2),r=t[0],a=t[1],i={name:a.name,permanent:a.permanent};return[r,i]});return e.reduce(A,{})}var mn=qr(),Vr=Gr(),Hr=Kr(),vn=Wr();const C={left:mn,right:Vr,values:Hr,storeNames:{left:vn,right:Fr(vn)}};var Ae=function(e){return e.LowerBound="lowerBound",e.UpperBound="upperBound",e}(Ae||{});function gn(e){return pe(e)}var _=function(e){return e.right="right",e.left="left",e}(_||{});function pn(e,n){return e&&e[n]!==void 0?e[n]:n}function zr(e,n,t,r,a){if(!a)return[t,r];var i=Pt(a)?a.key:a;if(gn(r)){var o=fn(a)?a.keys:null;return[i,$(e,n,r,o)]}var u=He(a)?a.values:null;return[i,pn(u,r)]}function $(e,n,t,r){if(t){var a=r||C[n][H(e,_.right)].fields;return O(t).map(function(i){var o=b(i,2),u=o[0],s=o[1];return zr(e,n,u,s,a[u])}).reduce(function(i,o){var u=b(o,2),s=u[0],c=u[1];return d(d({},i),{},y({},s,c))},{})}}function It(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return t.map(function(r){return $(e,n,r)})}function ue(e,n,t){var r=C[n][H(e,_.right)],a=r.fields[r.keyPath],i=t instanceof Array?t.slice():[t],o=ze(a)?a.composite:[r.keyPath],u=o.map(function(s,c){var l=r.fields[s],m=He(l)?l.values:null;return pn(m,i[c])});return u.length===1?u[0]:u}function hn(e){return C.values[e]||e}function H(e,n){return(C.storeNames[n][e]||{}).name||e}function Dt(e,n){return{name:n.name,message:n.message.replace('"'.concat(e,'"'),H(e,_.right))}}function Ce(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function yn(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Xt(r.key),r)}}function xe(e,n,t){return n&&yn(e.prototype,n),t&&yn(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function te(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=e+"",r=1;r<=n;r+=1)e<Math.pow(10,r)&&(t="0".concat(t));return t}function $r(e){var n=te(e.getDate()),t=te(e.getMonth()+1),r=e.getFullYear();return[r,t,n].join("-")}function Jr(e){var n=te(e.getHours(),1),t=te(e.getMinutes()),r=te(e.getSeconds()),a=te(e.getMilliseconds(),2);return[n,t,r].join(":")+"."+a}function Xr(e){var n=e.getTimezoneOffset(),t=te(Math.floor(Math.abs(n)/60)),r=te(Math.abs(n)%60),a=n>0?"-":"+";return a+t+r}function Ne(e){var n=e?new Date(e):new Date,t=$r(n),r=Jr(n),a=Xr(n);return"".concat(t,"T").concat(r,"Z").concat(a)}function Et(e,n){return isNaN(e)||isNaN(n)?0:Math.abs(n-e)}var se={},Ot=[];function Qr(){return"id"+Math.random().toString(36).substring(2,16)}function ne(e,n){var t=Qr(),r={id:t,cb:n};return se[e]||(se[e]=[]),se[e].push(r),t}function Yr(e){O(se).some(function(n){var t=b(n,2),r=t[1];return r.some(function(a,i){a.id===e&&r.splice(i,1)})})}function K(e,n){se[e]&&se[e].forEach(function(t){typeof t.cb=="function"&&Ot.push(setTimeout(function(){return t.cb(e,n)}))})}function Zr(){Ot.forEach(clearTimeout),Ot=[],se={}}var k={},T=!1,ye=!1;function ea(){return T?d({},k):{}}function bn(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};k=T?d({},e):{}}function ta(e){T=!0,bn(e)}function na(){return T}function $e(){T&&(k.lastInterval=oa(),k.lastActive=Date.now())}function Te(e){k=d(d({},k),e)}function _n(){ye=!0}function ra(){ye=!1}function Sn(){var e=k.lastActive;return Math.round(Et(e,Date.now())/ve)}function kn(){return(k.timeSpent||0)+(ye?Sn():0)}function Rt(){var e=k.lastActive,n=Et(e,Date.now())<N.sessionWindow,t=ye||!ye&&n;return(k.sessionLength||0)+(t?Sn():0)}function aa(){return k.sessionCount||0}function ia(){return k.eventCount||0}function oa(){var e=k.lastActive;return e?Math.round(Et(e,Date.now())/ve):-1}function ua(){Pn(),_n()}function sa(e){if(!T)return null;var n=k.lastInterval>=0?k.lastInterval:0,t={timeSpent:k.timeSpent||0,sessionLength:k.sessionLength||0,sessionCount:k.sessionCount||1,lastInterval:n||0};return e&&ee(e,"event")&&(t.eventCount=k.eventCount),t}function ca(e,n){if(T){var t={};t.timeSpent=kn(),t.sessionLength=Rt(),ee(e,"session")&&(t.sessionCount=aa()+1),ee(e,"event")&&(t.eventCount=ia()+1),Te(t),n||$e()}}function la(){T&&(k.installed||Te({installed:!0}))}function Pn(){if(T){var e=kn(),n=Rt();Te({timeSpent:e,sessionLength:n}),$e()}}function fa(){if(T){var e=Rt();Te({sessionLength:e}),$e()}}function da(){T&&Te({timeSpent:0,sessionLength:0})}function ma(){k={},T=!1,ye=!1}function va(){return T?k.attribution?k.attribution:(f.log("No attribution data yet"),null):null}function ga(){return k.attribution?Promise.resolve(k.attribution):new Promise(function(e){return ne(De.ATTRIBUTION_RECEIVED,function(n,t){return e(t)})})}function pa(){return T?k.uuid:null}function ha(){return k.uuid?Promise.resolve(k.uuid):new Promise(function(e){return ne(De.WEB_UUID_CREATED,function(n,t){return e(t)})})}var ya={get current(){return ea()},set current(e){bn(e)},init:ta,isStarted:na,toForeground:_n,toBackground:ra,initParams:ua,getParams:sa,updateParams:ca,updateInstalled:la,updateSessionOffset:Pn,updateSessionLength:fa,resetSessionOffset:da,updateLastActive:$e,destroy:ma,getAttribution:va,getWebUUID:pa,waitForAttribution:ga,waitForWebUUID:ha};const g=ya;var ba=function(){function e(){Ce(this,e),y(this,"items",{})}return xe(e,[{key:"getItem",value:function(t){return Object.prototype.hasOwnProperty.call(this.items,t)?this.items[t]:null}},{key:"removeItem",value:function(t){delete this.items[t]}},{key:"setItem",value:function(t,r){this.items[t]=r}}])}(),_a=function(){function e(){var n=this;Ce(this,e),y(this,"defaultName",ie.namespace),y(this,"storageName",this.defaultName),y(this,"storeNames",C.storeNames.left),this.storesMap={},an()?this.storage=window.localStorage:this.storage=new ba;var t=this.read.bind(this),r=this.write.bind(this);Ee(this.storeNames).forEach(function(a){var i=a.name;Object.defineProperty(n.storesMap,i,{get:function(){return t(i)},set:function(u){r(i,u)}})}),Object.freeze(this.storesMap)}return xe(e,[{key:"read",value:function(t){var r=this.storage.getItem("".concat(this.storageName,".").concat(t)),a=r?JSON.parse(r):null;return t===Oe.Preferences&&a?$(Oe.Preferences,_.right,a):a}},{key:"write",value:function(t,r){r?this.storage.setItem("".concat(this.storageName,".").concat(t),JSON.stringify(r instanceof Array?r:$(Oe.Preferences,_.left,r))):this.storage.removeItem("".concat(this.storageName,".").concat(t))}},{key:"clear",value:function(){this.deleteData()}},{key:"deleteData",value:function(){var t=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;Ee(this.storeNames).forEach(function(a){(r||!a.permanent)&&t.storage.removeItem("".concat(t.storageName,".").concat(a.name))})}},{key:"setCustomName",value:function(t){var r=this;if(!(!t||!t.length)){var a="".concat(ie.namespace,"-").concat(t);Ee(this.storeNames).forEach(function(i){var o=i.name,u=r.storage.getItem("".concat(r.storageName,".").concat(o));u&&r.storage.setItem("".concat(a,".").concat(o),u)}),this.deleteData(!0),this.storageName=a}}},{key:"stores",get:function(){return this.storesMap}}])}();const E=new _a;var je=Re.preferences.name,ce=null;ce=At();function At(){return ce||Ct(),ce?d({},ce):null}function Ct(){ce=E.stores[je]}function xt(){var e=At();return e&&e.sdkDisabled||null}function wn(e){var n=e?d({},e):null;E.stores[je]=d(d({},At()),{},{sdkDisabled:n}),Ct()}function Nt(){var e=E.stores[je]||{},n=(ce||{}).sdkDisabled||null;e.sdkDisabled&&!n&&K("sdk:shutdown"),Ct()}function In(){var e=E.stores[je];e||(E.stores[je]=d({},ce))}var x=function(e){return e.add="add",e.put="put",e.get="get",e.list="list",e.clear="clear",e.delete="delete",e}(x||{}),z=function(e){return e.readonly="readonly",e.readwrite="readwrite",e}(z||{}),Je=function(){function e(){Ce(this,e),y(this,"dbDefaultName",ie.namespace),y(this,"dbName",this.dbDefaultName),y(this,"dbVersion",1),y(this,"indexedDbConnection",null),y(this,"notSupportedError",{name:"IDBNotSupported",message:"IndexedDB is not supported"}),y(this,"databaseOpenError",{name:"CannotOpenDatabaseError",message:"Cannot open a database"}),y(this,"noConnectionError",{name:"NoDatabaseConnection",message:"Cannot open a transaction"});var n=e.getIndexedDB();if(!n)throw this.notSupportedError;this.idbFactory=n}return xe(e,[{key:"setCustomName",value:function(t){return t&&t.length>0?(this.dbName="".concat(ie.namespace,"-").concat(t),this.migrateDb(this.dbDefaultName,this.dbName)):Promise.resolve()}},{key:"openDatabase",value:function(t,r,a){var i=this;return e.isSupported().then(function(o){return o?new Promise(function(u,s){var c=i.idbFactory.open(t,a);r&&(c.onupgradeneeded=function(l){return r(l,s)}),c.onsuccess=function(l){var m=l.target.result;m?u(m):s(i.databaseOpenError)},c.onerror=s}):Promise.reject(i.notSupportedError)})}},{key:"databaseExists",value:function(t){var r=this;return new Promise(function(a){var i=!0;r.openDatabase(t,function(){i=!1}).then(function(o){if(o.close(),!i)return r.deleteDatabaseByName(t)}).then(function(){return a(i)})})}},{key:"cloneData",value:function(t,r){var a=this,i=function(l){var m=a.indexedDbConnection;return a.indexedDbConnection=t,a.getAll(l).then(function(h){if(a.indexedDbConnection=r,!(h.length<1))return a.addBulk(l,h,!0)}).then(function(){a.indexedDbConnection=m})};function o(c){return c!=="p"}var u=Ee(C.storeNames.left).map(function(c){return c.name}).filter(o),s=u.map(function(c){return function(){return i(c)}});return s.reduce(function(c,l){return c.then(l)},Promise.resolve())}},{key:"migrateDb",value:function(t,r){var a=this;return this.databaseExists(t).then(function(i){return i?Promise.all([a.openDatabase(t,a.handleUpgradeNeeded,a.dbVersion),a.openDatabase(r,a.handleUpgradeNeeded,a.dbVersion)]).then(function(o){var u=b(o,2),s=u[0],c=u[1];return a.cloneData(s,c).then(function(){return a.indexedDbConnection=c,s.close(),a.deleteDatabaseByName(t)})}).then(function(){return f.info("Database migration finished")}):a.openDatabase(r,a.handleUpgradeNeeded,a.dbVersion).then(function(o){a.indexedDbConnection=o})})}},{key:"handleUpgradeNeeded",value:function(t,r){var a=t.target.result;t.target.transaction.onerror=r,t.target.transaction.onabort=r;var i=C.storeNames.left,o=g.current||{},u=o&&!Y(o);O(i).filter(function(s){var c=b(s,2),l=c[1];return!l.permanent}).forEach(function(s){var c=b(s,2),l=c[0],m=c[1],h=m.name,p=C.right[l],P=a.createObjectStore(h,{keyPath:p.keyPath,autoIncrement:p.autoIncrement||!1});if(p.index&&P.createIndex("".concat(p.index,"Index"),p.index),h===oe.ActivityState&&u){P.add($(l,_.left,o)),f.info("Activity state has been recovered");return}var w=E.stores[h];w&&(w.forEach(function(D){return P.add(D)}),f.info("Migration from localStorage done for ".concat(l," store")))}),In(),E.clear()}},{key:"open",value:function(){var t=this;return this.indexedDbConnection?Promise.resolve({success:!0}):this.openDatabase(this.dbName,this.handleUpgradeNeeded,this.dbVersion).then(function(r){return t.indexedDbConnection=r,t.indexedDbConnection.onclose=function(){return t.destroy},{success:!0}})}},{key:"getTransactionStore",value:function(t,r,a){var i=t.storeName,o=t.mode,u=a.transaction([i],o),s=u.objectStore(i),c=C.right[H(i,_.right)],l;return c.index&&(l=s.index("".concat(c.index,"Index"))),u.onerror=r,u.onabort=r,{transaction:u,store:s,index:l,options:c}}},{key:"overrideError",value:function(t,r){var a=r.target.error,i=a.name,o=a.message;return t({name:i,message:o})}},{key:"getCompositeKeys",value:function(t){var r=t.fields[t.keyPath];return ze(r)?r.composite:null}},{key:"targetIsObject",value:function(t){return pe(t)}},{key:"prepareTarget",value:function(t,r,a){if(a===x.clear||!r)return null;var i=this.getCompositeKeys(t),o=[x.add,x.put].indexOf(a)!==-1;return o?this.targetIsObject(r)?i?d(y({},t.keyPath,i.map(function(u){return r[u]}).join("")),r):r:null:r instanceof Array?r.join(""):r}},{key:"prepareResult",value:function(t,r){var a=this.getCompositeKeys(t);return a&&this.targetIsObject(r)?a.map(function(i){return r[i]}):null}},{key:"initRequest",value:function(t){var r=this,a=t.storeName,i=t.target,o=i===void 0?null:i,u=t.action,s=t.mode,c=s===void 0?z.readonly:s;return this.open().then(function(){return new Promise(function(l,m){if(!r.indexedDbConnection)m(r.noConnectionError);else{var h=r.getTransactionStore({storeName:a,mode:c},m,r.indexedDbConnection),p=h.store,P=h.options,w=p[u](r.prepareTarget(P,o,u)),D=r.prepareResult(P,o);w.onsuccess=function(){u===x.get&&!w.result?m({name:"NotRecordFoundError",message:'Requested record not found in "'.concat(a,'" store')}):l(D||w.result||o)},w.onerror=function(U){return r.overrideError(m,U)}}})})}},{key:"initBulkRequest",value:function(t){var r=this,a=t.storeName,i=t.target,o=t.action,u=t.mode,s=u===void 0?z.readwrite:u;return!i||i&&!i.length?Promise.reject({name:"NoTargetDefined",message:"No array provided to perform ".concat(o,' bulk operation into "').concat(a,'" store')}):this.open().then(function(){return new Promise(function(c,l){if(!r.indexedDbConnection)l(r.noConnectionError);else{var m=r.getTransactionStore({storeName:a,mode:s},l,r.indexedDbConnection),h=m.transaction,p=m.store,P=m.options,w=new Array,D=i[0];h.oncomplete=function(){return c(w)};var U=function R(J){J.onerror=function(q){return r.overrideError(l,q)},J.onsuccess=function(){w.push(r.prepareResult(P,D)||J.result),D=i[w.length],w.length<i.length&&R(p[o](r.prepareTarget(P,D,o)))}};U(p[o](r.prepareTarget(P,D,o)))}})})}},{key:"openCursor",value:function(t){var r=this,a=t.storeName,i=t.action,o=t.range,u=o===void 0?null:o,s=t.firstOnly,c=s===void 0?!1:s,l=t.mode,m=l===void 0?z.readonly:l;return this.open().then(function(){return new Promise(function(h,p){if(!r.indexedDbConnection)p(r.noConnectionError);else{var P=r.getTransactionStore({storeName:a,mode:m},p,r.indexedDbConnection),w=P.transaction,D=P.store,U=P.index,R=P.options,J=(U||D).openCursor(u),q=new Array;w.oncomplete=function(){return h(q)},J.onsuccess=function(L){var F=L.target.result;F&&(i===x.delete?(F.delete(),q.push(r.prepareResult(R,F.value)||F.value[R.keyPath])):q.push(F.value),c||F.continue())},J.onerror=function(L){return r.overrideError(p,L)}}})})}},{key:"deleteDatabaseByName",value:function(t){var r=this;return new Promise(function(a,i){var o=r.idbFactory.deleteDatabase(t);o.onerror=function(u){return r.overrideError(i,u)},o.onsuccess=function(){return a()},o.onblocked=function(u){return i(u.target)}})}},{key:"getAll",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return this.openCursor({storeName:t,action:x.list,firstOnly:r})}},{key:"getFirst",value:function(t){return this.getAll(t,!0).then(function(r){return r.length?r[0]:void 0})}},{key:"getItem",value:function(t,r){return this.initRequest({storeName:t,target:r,action:x.get})}},{key:"filterBy",value:function(t,r){var a=IDBKeyRange.only(r);return this.openCursor({storeName:t,action:x.list,range:a})}},{key:"addItem",value:function(t,r){return this.initRequest({storeName:t,target:r,action:x.add,mode:z.readwrite})}},{key:"addBulk",value:function(t,r,a){return this.initBulkRequest({storeName:t,target:r,action:a?x.put:x.add,mode:z.readwrite})}},{key:"updateItem",value:function(t,r){return this.initRequest({storeName:t,target:r,action:x.put,mode:z.readwrite})}},{key:"deleteItem",value:function(t,r){return this.initRequest({storeName:t,target:r,action:x.delete,mode:z.readwrite})}},{key:"deleteBulk",value:function(t,r,a){var i=a?IDBKeyRange[a](r):IDBKeyRange.only(r);return this.openCursor({storeName:t,action:x.delete,range:i,mode:z.readwrite})}},{key:"trimItems",value:function(t,r){var a=this,i=C.right[H(t,_.right)];return this.getAll(t).then(function(o){return o.length?o[r-1]:null}).then(function(o){return o?a.deleteBulk(t,o[i.keyPath],Ae.UpperBound):[]})}},{key:"count",value:function(t){var r=this;return this.open().then(function(){return new Promise(function(a,i){if(!r.indexedDbConnection)i(r.noConnectionError);else{var o=r.getTransactionStore({storeName:t,mode:z.readonly},i,r.indexedDbConnection),u=o.store,s=u.count();s.onsuccess=function(){return a(s.result)},s.onerror=function(c){return r.overrideError(i,c)}}})})}},{key:"clear",value:function(t){return this.initRequest({storeName:t,action:x.clear,mode:z.readwrite})}},{key:"destroy",value:function(){this.indexedDbConnection&&this.indexedDbConnection.close(),this.indexedDbConnection=null}},{key:"deleteDatabase",value:function(){return this.destroy(),this.deleteDatabaseByName(this.dbName)}}],[{key:"tryOpen",value:function(t){return new Promise(function(r){try{var a=t.open(e.dbValidationName);a.onsuccess=function(){a.result.close(),t.deleteDatabase(e.dbValidationName),r(!0)},a.onerror=function(){return r(!1)}}catch(i){r(!1)}})}},{key:"isSupported",value:function(){if(e.isSupportedPromise)return e.isSupportedPromise;var t="IndexedDB is not supported in this browser";return e.isSupportedPromise=new Promise(function(r){var a=e.getIndexedDB(),i=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);if(!a||i)f.warn(t),r(!1);else{var o=e.tryOpen(a).then(function(u){return u||f.warn(t),u});r(o)}}),e.isSupportedPromise}},{key:"getIndexedDB",value:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB}}])}();y(Je,"dbValidationName","validate-db-openable"),y(Je,"isSupportedPromise",null);function Sa(e){if(Array.isArray(e))return gt(e)}function ka(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Pa(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Xe(e){return Sa(e)||ka(e)||pt(e)||Pa()}var Tt=function(){function e(){Ce(this,e)}return xe(e,[{key:"open",value:function(){return e.isSupported().then(function(t){if(!t)return{status:"error",error:{name:"LSNotSupported",message:"LocalStorage is not supported"}};var r=C.storeNames.left,a=g.current||{},i=a&&!Y(a);return O(r).filter(function(o){var u=b(o,2),s=u[1];return!s.permanent}).forEach(function(o){var u=b(o,2),s=u[0],c=u[1],l=c.name;l===oe.ActivityState&&!E.stores[l]?E.stores[l]=i?[$(s,_.left,a)]:[]:E.stores[l]||(E.stores[l]=[])}),In(),{status:"success"}})}},{key:"getCompositeKeys",value:function(t){var r=t.fields[t.keyPath];return ze(r)?r.composite:null}},{key:"getKeys",value:function(t){var r=H(t,_.right),a=C.right[r];return this.getCompositeKeys(a)||[a.keyPath]}},{key:"nextIndex",value:function(t){return typeof t=="number"?t+1:void 0}},{key:"initRequest",value:function(t,r){var a=this,i=t.storeName,o=t.id,u=t.item,s=C.right[H(i,_.right)];return this.open().then(function(c){return c.status==="error"?Promise.reject(c.error):new Promise(function(l,m){var h=E.stores[i],p=a.getKeys(i),P=(h[h.length-1]||{})[s.keyPath]||0,w;if(!o)w=d({},u);else{var D=Array.isArray(o)?o.slice():[o];w=p.map(function(R,J){return[R,D[J]]}).reduce(A,{})}var U=w?nn(h,p,w):0;return r(l,m,{keys:p,items:h,index:U,options:s,lastId:P})})})}},{key:"sort",value:function(t,r,a){var i=Xe(t),o=r.slice().reverse();function u(s,c,l){var m=a?a===s[l]:s[l]<c[l],h=a?a>s[l]:s[l]>c[l];return m?-1:h?1:0}return i.sort(function(s,c){return o.reduce(function(l,m){return l||u(s,c,m)},0)})}},{key:"prepareTarget",value:function(t,r,a){var i=this.getCompositeKeys(t);return i?d(y({},t.keyPath,i.map(function(o){return r[o]}).join("")),r):t.autoIncrement&&a?d(y({},t.keyPath,a),r):d({},r)}},{key:"prepareResult",value:function(t,r){var a=this.getCompositeKeys(t);return a?a.map(function(i){return r[i]}).filter(function(i){return!gn(i)}):r[t.keyPath]}},{key:"getAll",value:function(t){var r=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return this.open().then(function(i){return i.status==="error"?Promise.reject(i.error):new Promise(function(o,u){var s=E.stores[t];s instanceof Array?o(a?[s[0]]:r.sort(s,r.getKeys(t))):u({name:"NotFoundError",message:"No objectStore named ".concat(t," in this database")})})})}},{key:"getFirst",value:function(t){return this.getAll(t,!0).then(function(r){return r.length?r[0]:void 0})}},{key:"getItem",value:function(t,r){var a=this,i=function(u,s,c){var l=c.items,m=c.index,h=c.options;m===-1?s({name:"NotRecordFoundError",message:'Requested record not found in "'.concat(t,'" store')}):u(a.prepareTarget(h,l[m]))};return this.initRequest({storeName:t,id:r},i)}},{key:"filterBy",value:function(t,r){return this.getAll(t).then(function(a){return a.filter(function(i){var o=C.right[H(t,_.right)],u=o.index&&i[o.index];return u===r})})}},{key:"addItem",value:function(t,r){var a=this;return this.initRequest({storeName:t,item:r},function(i,o,u){var s=u.items,c=u.index,l=u.options,m=u.lastId;c!==-1?o({name:"ConstraintError",message:'Constraint was not satisfied, trying to add existing item into "'.concat(t,'" store')}):(s.push(a.prepareTarget(l,r,a.nextIndex(m))),E.stores[t]=s,i(a.prepareResult(l,r)))})}},{key:"addBulk",value:function(t,r,a){var i=this;return this.initRequest({storeName:t},function(o,u,s){var c=s.keys,l=s.items,m=s.options,h=s.lastId;if(!r||r&&!r.length){u({name:"NoTargetDefined",message:'No array provided to perform add bulk operation into "'.concat(t,'" store')});return}var p=h,P=r.map(function(R){return i.prepareTarget(m,R,p=i.nextIndex(p))}),w=P.filter(function(R){return nn(l,c,R)!==-1}).map(function(R){return R[m.keyPath]}),D=a?l.filter(function(R){return w.indexOf(R[m.keyPath])===-1}):Xe(l);if(w.length&&!a)u({name:"ConstraintError",message:'Constraint was not satisfied, trying to add existing items into "'.concat(t,'" store')});else{E.stores[t]=i.sort([].concat(Xe(D),Xe(P)),c);var U=r.map(function(R){return i.prepareResult(m,R)});o(U)}})}},{key:"updateItem",value:function(t,r){var a=this;return this.initRequest({storeName:t,item:r},function(i,o,u){var s=u.items,c=u.index,l=u.options,m=u.lastId,h=c===-1?a.nextIndex(m):void 0,p=a.prepareTarget(l,r,h);c===-1?s.push(p):s.splice(c,1,p),E.stores[t]=s,i(a.prepareResult(l,r))})}},{key:"deleteItem",value:function(t,r){return this.initRequest({storeName:t,id:r},function(a,i,o){var u=o.items,s=o.index;s!==-1&&(u.splice(s,1),E.stores[t]=u),a(r)})}},{key:"findMax",value:function(t,r,a){if(!t.length)return-1;for(var i={index:-1,value:typeof a=="string"?"":0},o=0;o<t.length;o+=1)if(t[o][r]<=a)t[o][r]>=i.value&&(i={value:t[o][r],index:o});else return i.index;return i.index}},{key:"deleteBulk",value:function(t,r,a){var i=this;return this.getAll(t).then(function(o){var u=i.getKeys(t),s=C.right[H(t,_.right)].index||u[0],c=a?null:r,l=i.sort(o,u,c),m=i.findMax(l,s,r);if(m===-1)return[];var h=a===Ae.LowerBound?m:0,p=!a||a===Ae.UpperBound?m+1:l.length,P=l.splice(h,p).map(function(w){return u.length===1?w[s]:u.map(function(D){return w[D]})});return E.stores[t]=l,P})}},{key:"trimItems",value:function(t,r){var a=this,i=H(t,_.right),o=C.right[i];return this.getAll(t).then(function(u){return u.length?u[r-1]:null}).then(function(u){return u?a.deleteBulk(t,u[o.keyPath],Ae.UpperBound):[]})}},{key:"count",value:function(t){return this.open().then(function(r){if(r.status==="error")return Promise.reject(r.error);var a=E.stores[t];return Promise.resolve(a instanceof Array?a.length:1)})}},{key:"clear",value:function(t){return this.open().then(function(r){return r.status==="error"?Promise.reject(r.error):new Promise(function(a){E.stores[t]=[],a()})})}},{key:"destroy",value:function(){}},{key:"deleteDatabase",value:function(){}}],[{key:"isSupported",value:function(){return e.isSupportedPromise||(e.isSupportedPromise=new Promise(function(t){var r=an();r||f.warn("LocalStorage is not supported in this browser"),t(r)})),e.isSupportedPromise}}])}();y(Tt,"isSupportedPromise",null);var Qe=function(e){return e[e.noStorage=ge.NO_STORAGE]="noStorage",e[e.indexedDB=ge.INDEXED_DB]="indexedDB",e[e.localStorage=ge.LOCAL_STORAGE]="localStorage",e}(Qe||{}),wa={getAll:Ia,getFirst:Da,getItem:Ea,filterBy:Oa,addItem:Ra,addBulk:Aa,updateItem:Ca,deleteItem:xa,deleteBulk:Na,trimItems:Ta,count:ja,clear:Ba,destroy:Ua,deleteDatabase:La};function Ia(e,n,t){return e.getAll(n,t).then(function(r){return It(n,_.right,r)})}function Da(e,n){return e.getFirst(n).then(function(t){return $(n,_.right,t)})}function Ea(e,n,t){return e.getItem(n,ue(n,_.left,t)).then(function(r){return $(n,_.right,r)}).catch(function(r){return Promise.reject(Dt(n,r))})}function Oa(e,n,t){return e.filterBy(n,hn(t)).then(function(r){return It(n,_.right,r)})}function Ra(e,n,t){var r=$(n,_.left,t);return e.addItem(n,r).then(function(a){return ue(n,_.right,a)}).catch(function(a){return Promise.reject(Dt(n,a))})}function Aa(e,n,t,r){var a=It(n,_.left,t);return e.addBulk(n,a,r).then(function(i){return i.map(function(o){return ue(n,_.right,o)})}).catch(function(i){return Promise.reject(Dt(n,i))})}function Ca(e,n,t){var r=$(n,_.left,t);return e.updateItem(n,r).then(function(a){return ue(n,_.right,a)})}function xa(e,n,t){return e.deleteItem(n,ue(n,_.left,t)).then(function(r){return ue(n,_.right,r)})}function Na(e,n,t,r){return e.deleteBulk(n,hn(t),r).then(function(a){return a.map(function(i){return ue(n,_.right,i)})})}function Ta(e,n,t){return e.trimItems(n,t)}function ja(e,n){return e.count(n)}function Ba(e,n){return e.clear(n)}function Ua(e){return e.destroy()}function La(e){return e.deleteDatabase()}function Fa(){var e=O(wa).map(function(n){var t=b(n,2),r=t[0],a=t[1],i=function(u){for(var s=arguments.length,c=new Array(s>1?s-1:0),l=1;l<s;l++)c[l-1]=arguments[l];return Dn().then(function(m){var h=m.storage;if(h)return a.call.apply(a,[null,h,H(u,_.left)].concat(c))})};return[r,i]});return e.reduce(A,{})}var Be;function Ma(){return Be}var Ye=null;function Dn(e){var n=null;return Ye!==null||(Ye=Promise.all([Je.isSupported(),Tt.isSupported()]).then(function(t){var r=b(t,2),a=r[0],i=r[1];if(E.setCustomName(e),a){Be=Qe.indexedDB;var o=new Je;return o.setCustomName(e).then(function(){return n=o})}else return i?(Be=Qe.localStorage,n=new Tt,Promise.resolve(n)):(f.error("There is no storage available, app will run with minimum set of features"),Be=Qe.noStorage,n=null,Promise.resolve(n))}).then(function(){return{type:Be,storage:n}})),Ye}const S=d({init:Dn,getType:Ma},Fa());function qa(){return{createdAt:Ne()}}function Ga(){return{sentAt:Ne()}}function Ka(){return{webUuid:g.current.uuid}}function Wa(){var e=navigator,n=typeof e.doNotTrack<"u",t=typeof window.doNotTrack<"u",r=typeof e.msDoNotTrack<"u",a=n?e.doNotTrack:t?window.doNotTrack:r?e.msDoNotTrack:null;return parseInt(a,10)===0||a==="no"?{trackingEnabled:!0}:parseInt(a,10)===1||a==="yes"?{trackingEnabled:!1}:null}function Va(){return{platform:"web"}}function Ha(){var e=navigator,n=(e.language||e.userLanguage||"en").split("-"),t=b(n,2),r=t[0],a=t[1];return{language:r,country:a?""+a.toLowerCase():void 0}}function za(){var e=navigator.userAgent||navigator.vendor,n=navigator.platform==="Win32"&&(e.indexOf("WOW64")!==-1||e.indexOf("Win64")!==-1);return{machineType:n?"Win64":navigator.platform}}function $a(){return S.getAll("queue").then(function(e){return{queueSize:e.length}})}function Ja(){return $a().then(function(e){return d(d(d(d(d(d(d(d({},qa()),Ga()),Ka()),Wa()),Va()),Ha()),za()),e)})}function Xa(e,n){var t=JSON.parse(e.responseText),r={status:"success",adid:t.adid,timestamp:t.timestamp,ask_in:t.ask_in,retry_in:t.retry_in,continue_in:t.continue_in,tracking_state:t.tracking_state,attribution:void 0,message:void 0};return ee(n,"attribution")&&(r.attribution=t.attribution,r.message=t.message),O(r).filter(function(a){var i=b(a,2),o=i[1];return!!o}).reduce(A,{})}function Ue(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return{status:"error",action:t?"CONTINUE":"RETRY",response:tn(e.responseText)?JSON.parse(e.responseText):e.responseText,message:vt[n],code:n}}function Qa(e){var n=b(e,2),t=n[0],r=n[1],a=encodeURIComponent(t),i=r;return typeof r=="string"&&(i=encodeURIComponent(r)),pe(r)&&(i=encodeURIComponent(JSON.stringify(r)||"")),t==="granular_third_party_sharing_options"||t==="partner_sharing_settings"?[a,i].join(encodeURIComponent("=")):[a,i].join("=")}function En(e,n){var t=e.slice(0,e.length-n.length-1).split("").reduce(function(r){return r.concat(" ")},"");return"".concat(n).concat(t,":")}function Ya(e,n){var t="REQUEST PARAMETERS:",r=function(o){return o.replace(/([A-Z])/g,function(u){return"_".concat(u.toLowerCase())})},a=O(d(d(d({},N.getBaseParams()),n),e)).map(function(i){var o=b(i,2),u=o[0],s=o[1];return[r(u),s]});return f.log(t),a.filter(function(i){var o=b(i,2),u=o[1];return ht(u)}).map(function(i){var o=b(i,2),u=o[0],s=o[1];return f.log(En(t,u),s),Qa([u,s])}).join("&")}function Za(e,n,t){var r=t.xhr,a=t.url;if(r.readyState===4){var i=r.status>=200&&r.status<300,o=tn(r.responseText);if(r.status===0)e(Ue(r,"NO_CONNECTION"));else return o?n(i?Xa(r,a):Ue(r,"SERVER_CANNOT_PROCESS",!0)):e(i?Ue(r,"SERVER_MALFORMED_RESPONSE"):Ue(r,"SERVER_INTERNAL_ERROR"))}}function ei(e,n){var t=e.endpoint,r=e.url,a=e.method,i=e.params,o=Ya(i,n);return{fullUrl:t+r+(a==="GET"?"?".concat(o):""),encodedParams:o}}function ti(e,n){var t="REQUEST HEADERS:",r=[["Client-SDK","js".concat(ie.version)],["Content-Type",n==="POST"?"application/x-www-form-urlencoded":"application/json"]];f.log(t),r.forEach(function(a){var i=b(a,2),o=i[0],u=i[1];e.setRequestHeader(o,u),f.log(En(t,o),u)})}function ni(e,n){var t=e.endpoint,r=e.url,a=e.method,i=a===void 0?"GET":a,o=e.params,u=o===void 0?{}:o,s=ei({endpoint:t,url:r,method:i,params:u},n),c=s.fullUrl,l=s.encodedParams;return new Promise(function(m,h){var p=new XMLHttpRequest;p.open(i,c,!0),ti(p,i),p.onreadystatechange=function(){return Za(h,m,{xhr:p,url:r})},p.onerror=function(){return h(Ue(p,"TRANSACTION_ERROR"))},p.send(i==="GET"?void 0:l)})}function ri(e,n){return e.status==="success"?ai(e,n):e}function ai(e,n){var t=ee(n,"gdpr_forget_device"),r=ee(n,"attribution"),a=ee(n,"session"),i=e.tracking_state==="opted_out";return!t&&i?(K("sdk:gdpr-forget-me"),e):(!r&&!t&&!i&&e.ask_in&&K("attribution:check",e),a&&K("session:finished",e),e)}function ii(e){return Ja().then(function(n){return ni(e,n)}).then(function(n){return ri(n,e.url)})}var oi={long:{delay:2*mt,maxDelay:Zt,minRange:.5,maxRange:1},short:{delay:200,maxDelay:Yt,minRange:.5,maxRange:1},test:{delay:100,maxDelay:300}};function ui(e,n){return Math.random()*(n-e)+e}function si(e,n){n=n||"long";var t=oi[n],r=t.delay*Math.pow(2,e-1);return r=Math.min(r,t.maxDelay),t.minRange&&t.maxRange&&(r=r*ui(t.minRange,t.maxRange)),Math.round(r)}var jt=navigator.onLine;function ci(){Ze(window,"online",On),Ze(window,"offline",Rn)}function On(){jt=!0}function Rn(){jt=!1}function Ze(e,n,t){e.addEventListener&&e.addEventListener(n,t,!1)}function et(e,n,t){e.removeEventListener&&e.removeEventListener(n,t,!1)}function li(){var e=document;if(typeof e.hidden<"u")return{hidden:"hidden",visibilityChange:"visibilitychange"};for(var n={mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange",webkitHidden:"webkitvisibilitychange"},t=O(n),r=0;r<t.length;r+=1){var a=b(t[r],2),i=a[0],o=a[1];if(typeof e[i]<"u")return{hidden:i,visibilityChange:o}}return null}function fi(){return jt}function di(){et(window,"online",On),et(window,"offline",Rn)}function mi(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=pt(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(c){throw c},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,o=!1,u;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return i=c.done,c},e:function(c){o=!0,u=c},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(o)throw u}}}}function Bt(e){return{domains:[e.default,e.world],useSubdomains:!0,isDataResidency:!1}}var Ut=function(e){return e.Default="default",e.India="india",e.China="china",e}(Ut||{});function An(e,n){f.warn("Both ".concat(e," and ").concat(n," are set in config, ").concat(n," will be ignored"))}function vi(e){var n=N.getCustomConfig(),t=n.customUrl,r=n.urlStrategy,a=n.dataResidency;if(t)return f.warn("customUrl is deprecated, use urlStrategy instead"),(a||r)&&An("customUrl",a?"dataResidency":"urlStrategy"),{domains:[t],useSubdomains:!1,isDataResidency:!1};if(a&&r&&An("dataResidency","urlStrategy"),a)return f.warn("dataResidency is deprecated, use urlStrategy instead"),{domains:[e[a]],useSubdomains:!0,isDataResidency:!0};if(typeof r=="string"){if(f.warn("urlStrategy string literals ('china' and 'india') are deprected, use UrlStartegyConfig instead"),r===Ut.India)return{domains:[e.india,e.default],useSubdomains:!0,isDataResidency:!1};if(r===Ut.China)return{domains:[e.china,e.default],useSubdomains:!0,isDataResidency:!1}}return r?null:Bt(e)}function gi(e){var n=N.getCustomConfig(),t=n.urlStrategy;if(t&&Q(t)==="object"){var r=t;return!r.domains||!Array.isArray(r.domains)||r.domains.length<1?(f.warn("Invalid urlStartegy: `domains` should be a non-empty array"),Bt(e)):{domains:r.domains,useSubdomains:!!r.useSubdomains,isDataResidency:!!r.isDataResidency}}return Bt(e)}function pi(e){return vi(e)||gi(e)}function hi(e){var n=pi(e),t=[],r=mi(n.domains),a;try{for(r.s();!(a=r.n()).done;){var i=a.value,o=n.useSubdomains?{app:"".concat(fr).concat(i),gdpr:"".concat(dr).concat(i)}:{app:"".concat(en).concat(i),gdpr:"".concat(en).concat(i)};t.push(o)}}catch(u){r.e(u)}finally{r.f()}return t}function yi(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:lr,n=hi(e),t=0;return{next:function(){return t<n.length?{value:n[t++],done:!1}:{value:void 0,done:!0}},reset:function(){t=0}}}var be=0,tt=150,Cn=2147483647,Lt=60*ve,bi=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.url,r=n.method,a=r===void 0?"GET":r,i=n.params,o=i===void 0?{}:i,u=n.continueCb,s=n.strategy,c=n.wait,l={url:t,method:a,params:o,continueCb:u},m=t,h=a,p=d({},o),P=u,w=s,D,U,R=function(){D.reset(),U=D.next()},J=function(I,W){var V=W==="/gdpr_forget_device"?"gdpr":"app";return I[V]},q=null,L={request:be,connection:be},F=tr(c),we=null;function tr(v){return v=v||tt,v>Cn?Cn:v}function Vo(v){var I=v.url,W=v.method,V=v.params,X=v.continueCb;I&&(m=I),W&&(h=W),Y(V)||(p=d({},V)),p=d({createdAt:Ne()},p),typeof X=="function"&&(P=X)}function Ho(v){if(!we)return!1;if(q){var I=F-(Date.now()-we);if(v&&I<v)return!0;dt()}return!1}function nr(v){var I=v.wait,W=v.retrying;return D||(D=yi(),U=D.next()),F=I?tr(I):F,Ho(I)?Promise.resolve({status:"error",action:"CONTINUE",response:"",message:vt.SKIP,code:"SKIP"}):m?(f.log("".concat(W?"Re-trying":"Trying"," request ").concat(m," in ").concat(F,"ms")),we=Date.now(),rr({endpoint:J(U.value,m),url:m,method:h,params:d({attempts:1},p)})):(f.error("You must define url for the request to be sent"),Promise.reject({status:"error",action:"CONTINUE",response:"",message:vt.MISSING_URL,code:"MISSING_URL"}))}function rr(v){return ir(),fi()?zo(v):(L.connection+=1,f.log("No internet connectivity, trying request ".concat(v.url," in ").concat(Lt,"ms")),new Promise(function(I){q=setTimeout(function(){I(rr(v))},Lt)}))}function zo(v){return new Promise(function(I,W){q=setTimeout(function(){we=null;var V=O(v.params).filter(function(X){var $t=b(X,2),Jt=$t[1];return ht(Jt)}).reduce(A,{});return ii({endpoint:v.endpoint,url:v.url,method:v.method,params:d(d({},V),{},{attempts:(L.request?L.request+1:1)+L.connection})}).then(function(X){return $o(X,I)}).catch(function(X){return Jo(X,I,W)})},F)})}function ar(){m=l.url,h=l.method,p=d({},l.params),P=l.continueCb}function zt(v){f.log("Request ".concat(m||"unknown"," ").concat(v?"failed":"has been finished")),L.request=be,L.connection=be,F=tt,ar(),dt()}function qe(v){return L.request+=1,dt(),nr({wait:v||si(L.request,w),retrying:!0})}function $o(v,I){if(v&&v.retry_in){I(qe(v.retry_in));return}R(),typeof P=="function"?P(v,zt,qe):zt(),I(v)}function Jo(v,I,W){if(v&&v.action==="RETRY"){if(v.code==="NO_CONNECTION"){var V=D.next();V.done?(R(),I(qe(Lt))):(U=V,I(qe(tt)))}else I(qe());return}zt(!0),W(v||{})}function Xo(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},I=v.url,W=v.method,V=v.params,X=V===void 0?{}:V,$t=v.continueCb,Jt=v.wait;return Vo({url:I,method:W,params:X,continueCb:$t}),nr({wait:Jt})}function Qo(){return!!q}function ir(){q&&clearTimeout(q),q=null}function dt(){var v=!!we;ir(),we=null,v&&(F=tt,L.request=be,L.connection=be,f.log("Previous ".concat(m||"unknown"," request attempt canceled")),ar())}return{send:Xo,isRunning:Qo,clear:dt}};const Ft=bi;var nt=function(n){return n===G.REASON_GDPR?"GDPR disable":"disable"},xn=function(n){return{start:{inProgress:"Adjust SDK ".concat(nt(n)," process has already started"),done:"Adjust SDK ".concat(nt(n)," process is now started")},finish:{inProgress:"Adjust SDK ".concat(nt(n)," process has already finished"),done:"Adjust SDK ".concat(nt(n)," process is now finished")}}};function Nn(e,n){var t=e.reason,r=e.pending,a=xt()||{},i=a.reason,o=a.pending,u=n==="start"&&o?"start":"finish",s=n==="start"&&i,c=n==="finish"&&i&&!o;return s||c?(f.log(xn(i)[u].inProgress),!1):(f.log(xn(t)[u].done),wn({reason:t||G.REASON_GENERAL,pending:r}),!0)}function Mt(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return Nn({reason:e,pending:n},"start")}function _i(e){return Nn({reason:e,pending:!1},"finish")}function Si(){var e=xt()||{},n=e.reason;return n===G.REASON_GDPR?(f.log("Adjust SDK is disabled due to GDPR-Forget-Me request and it can not be re-enabled"),!1):n?(f.log("Adjust SDK has been enabled"),wn(null),!0):(f.log("Adjust SDK is already enabled"),!1)}function Z(){var e=xt()||{},n=e.reason,t=e.pending;return n===G.REASON_GENERAL||n===G.REASON_GDPR&&!t?"off":n===G.REASON_GDPR&&t?"paused":"on"}var _e=ln.ActivityState,rt=!1;function ki(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(n==="x"?t:t&11).toString(16)})}function Pi(e){return e?e.uuid==="unknown"?(Mt(G.REASON_GDPR),g.destroy(),{exists:!0,stored:null}):(g.init(e),{exists:!0,stored:e}):{exists:!1}}function wi(){return rt?Promise.reject({interrupted:!0,message:"Adjust SDK start already in progress"}):(rt=!0,S.getFirst(_e).then(Pi).then(function(e){if(e.exists)return rt=!1,e.stored;var n=Y(g.current)?{uuid:ki()}:g.current;return S.addItem(_e,n).then(function(){return g.init(n),Nt(),rt=!1,n})}).then(function(e){return e?K(De.WEB_UUID_CREATED,e.uuid):K(De.WEB_UUID_CREATED,"gdpr_forgotten"),e}))}function Tn(){return Z()!=="off"&&g.isStarted()}function le(){if(!Tn())return Promise.resolve(null);var e=d(d({},g.current),{},{lastActive:Date.now()});return S.updateItem(_e,e).then(function(){return g.current=e})}function Ii(){return S.getFirst(_e).then(function(e){var n=g.current,t=n.lastActive||0;if(Tn()&&t<e.lastActive){var r=!n.installed&&e.installed,a=(n.sessionCount||0)<(e.sessionCount||0);(r||a)&&K("sdk:installed"),g.current=e,Nt()}return e})}function Di(){var e={uuid:"unknown"};return g.current=e,S.clear(_e).then(function(){return S.addItem(_e,e)})}function Ei(){g.destroy()}var jn=Ft({strategy:"long",continueCb:Oi}),at=!1,Se="queue",j={running:!1,timestamp:null,pause:null};function Oi(e,n){var t=e&&e.continue_in||null;return j.pause=t?{timestamp:Date.now(),wait:t}:null,S.getFirst(Se).then(function(r){return r?S.deleteItem(Se,r.timestamp):null}).then(function(){return n(),j.running=!1,ot({wait:t})})}function Ri(){var e=Date.now();return j.timestamp&&e<=j.timestamp&&(e=j.timestamp+1),j.timestamp=e,e}function Ai(e){return ee(e,"session")&&g.resetSessionOffset(),g.updateLastActive(),le()}function it(e){var n=e.url,t=e.method,r=e.params,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=a.auto,o=a.timestamp;g.updateParams(n,i);var u=O(r||{}).filter(function(c){var l=b(c,2),m=l[1];return ht(m)}).reduce(A,{}),s={timestamp:Ri(),url:n,method:t,params:d(d({},g.getParams(n)),u)};return o&&(s.createdAt=o),S.addItem(Se,s).then(function(){return Ai(n)}).then(function(){return j.running?{}:ot()})}function Ci(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.timestamp,t=e.createdAt,r=e.url,a=e.method,i=e.params,o=arguments.length>1?arguments[1]:void 0,u=g.current||{},s=r==="/session"&&!u.installed,c=!r&&!a&&!i;return at&&!s||c?(j.running=!1,Promise.resolve({})):jn.send({url:r,method:a,params:d(d({},i),{},{createdAt:Ne(t||n)}),wait:o||xi()})}function xi(){var e=j.pause||{},n=e.timestamp,t=e.wait,r=Date.now()-(n||0);return r<t?t-r:null}function ot(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.cleanUp,t=e.wait;if(j.running)return Promise.resolve({});j.running=!0;var r=Promise.resolve({});return n&&(r=r.then(Ni)),r.then(function(){return S.getFirst(Se)}).then(function(a){return Ci(a,t)})}function Bn(e){if(e===void 0){f.error("State not provided, true or false has to be defined");return}if(e===at){f.error("The app is already in ".concat(e?"offline":"online"," mode"));return}var n=at;at=e,!e&&n&&ot(),f.info("The app is now in ".concat(e?"offline":"online"," mode"))}function Ni(){var e=Date.now()-N.requestValidityWindow;return S.deleteBulk(Se,e,"upperBound")}function Ti(){return S.clear(Se)}function ji(){jn.clear(),j.running=!1,j.timestamp=null,j.pause=null}var fe="globalParams",ke={short:"No type provided",long:"Global parameter type not provided, `callback` or `partner` types are available"};function Un(e){return(e||[]).map(function(n){var t=n.key,r=n.value;return{key:t,value:r}})}function Ln(){return Promise.all([S.filterBy(fe,"callback"),S.filterBy(fe,"partner")]).then(function(e){var n=b(e,2),t=n[0],r=n[1];return{callbackParams:Un(t),partnerParams:Un(r)}})}function Fn(e,n){if(n===void 0)return f.error(ke.long),Promise.reject({message:ke.short});var t=ae(e),r=Object.keys(t).map(function(a){return{key:a,value:t[a],type:n}});return Promise.all([S.filterBy(fe,n),S.addBulk(fe,r,!0)]).then(function(a){var i=b(a,2),o=i[0],u=i[1],s=rn(o.map(function(c){return c.key}),u.map(function(c){return c[0]}));return f.log("Following ".concat(n," parameters have been saved: ").concat(r.map(function(c){return"".concat(c.key,":").concat(c.value)}).join(", "))),s.length&&f.log("Keys: ".concat(s.join(", ")," already existed so their values have been updated")),u})}function Mn(e,n){return n===void 0?(f.error(ke.long),Promise.reject({message:ke.short})):S.deleteItem(fe,[e,n]).then(function(t){return f.log("".concat(e," ").concat(n," parameter has been deleted")),t})}function qn(e){return e===void 0?(f.error(ke.long),Promise.reject({message:ke.short})):S.deleteBulk(fe,e).then(function(n){return f.log("All ".concat(e," parameters have been deleted")),n})}function Bi(){return S.clear(fe)}var ut=!1,Gn,qt,M,de=document;function Ui(){return M=li(),ut?Promise.reject({interrupted:!0,message:"Session watch already initiated"}):(ut=!0,ne("session:finished",qi),M&&Ze(de,M.visibilityChange,Kn),M&&de[M.hidden]?(f.log("Session request attempt canceled because the tab is still hidden"),Promise.resolve({})):(g.initParams(),Vn()))}function Li(){ut=!1,g.toBackground(),Gt(),M&&(clearTimeout(qt),et(de,M.visibilityChange,Kn),Ze(de,M.visibilityChange,Wn))}function Fi(){return Gt(),g.updateSessionOffset(),g.toBackground(),le()}function Mi(){return Ii().then(function(){g.updateSessionLength(),g.toForeground()}).then(Vn)}function Kn(){clearTimeout(qt);var e=M&&de[M.hidden]?Fi:Mi;qt=setTimeout(e,0)}function Wn(){!M||de[M.hidden]||(Nt(),!ut&&Z()==="on"&&(et(de,M.visibilityChange,Wn),er.__internal__.restartAfterAsyncEnable()))}function qi(e,n){if(n&&n.status==="error"){f.error("Session was not successful, error was returned from the server:",n.response);return}return g.updateInstalled(),K("sdk:installed"),le()}function Gi(){Gt(),Gn=setInterval(function(){return g.updateSessionOffset(),le()},N.sessionTimerWindow)}function Gt(){clearInterval(Gn)}function Ki(e){var n=e.callbackParams,t=e.partnerParams;return{callbackParams:n.length?ae(n):null,partnerParams:t.length?ae(t):null}}function Wi(){return Ln().then(function(e){it({url:"/session",method:"POST",params:Ki(e)},{auto:!0})})}function Vn(){Gi();var e=g.current,n=e.lastInterval,t=e.sessionCount>0,r=n*ve;return!t||t&&r>=N.sessionWindow?Wi():(K("attribution:check"),le())}var Hn=Ft({url:"/attribution",strategy:"short",continueCb:$i}),Kt=["tracker_token","tracker_name","network","campaign","adgroup","creative","click_label","state"];function Vi(e){var n=e.adid,t=e.attribution,r=g.current.attribution||{},a=t&&Kt.some(function(i){return r[i]!==t[i]});return!a&&n===r.adid}function Hi(e){var n=e.adid,t=n===void 0?"":n,r=e.attribution,a=r===void 0?{}:r;return!!t&&!!rn(Kt,Object.keys(a)).length}function zi(e){if(Y(e)||!Hi(e)||Vi(e))return Promise.resolve({state:"same"});var n=O(e.attribution).filter(function(t){var r=b(t,1),a=r[0];return Kt.indexOf(a)!==-1}).reduce(A,{adid:e.adid});return g.current=d(d({},g.current),{},{attribution:n}),le().then(function(){return K("attribution:change",n),K(De.ATTRIBUTION_RECEIVED,n),f.info("Attribution has been updated"),{state:"changed"}})}function $i(e,n,t){return!e||e&&e.status==="error"?(n(),Promise.resolve({state:"unknown"})):e.ask_in?t(e.ask_in):(n(),zi(e))}function Ji(e){var n=g.current,t=(e||{}).ask_in;return!t&&(n.attribution||!n.installed)?Promise.resolve(n):(Hn.send({params:d({initiatedBy:e?"backend":"sdk"},g.getParams()),wait:t}),g.updateSessionOffset(),le())}function Xi(){Hn.clear()}var zn=Ft({url:"/gdpr_forget_device",method:"POST",strategy:"short"}),Wt={running:"Adjust SDK is running pending GDPR Forget Me request",pending:"Adjust SDK will run GDPR Forget Me request after initialisation",paused:"Adjust SDK is already prepared to send GDPR Forget Me request",off:"Adjust SDK is already disabled"};function $n(e){var n=Z();return!e&&n!=="on"?(f.log(Wt[n]),!1):N.isInitialised()?(zn.send({params:d({},g.getParams())}).then(function(){K("sdk:gdpr-forget-me")}),!0):(f.log(Wt.pending),!0)}function Qi(){return Mt(G.REASON_GDPR,!0)}function Yi(){return _i(G.REASON_GDPR)}function Zi(){Z()==="paused"&&(f.log(Wt.running),$n(!0))}function eo(){zn.clear()}var to=function(){function e(n){Ce(this,e),y(this,"_granularOptions",{}),y(this,"_partnerSharingSettings",{}),typeof n!="boolean"&&f.warn("isEnabled should be boolean, converting ".concat(n," results ").concat(!!n)),this._isEnabled=!!n}return xe(e,[{key:"isEnabled",get:function(){return this._isEnabled}},{key:"granularOptions",get:function(){return this._granularOptions}},{key:"partnerSharingSettings",get:function(){return this._partnerSharingSettings}},{key:"addGranularOption",value:function(t,r,a){if(!t||!r||a===void 0){f.error("Cannot add granular option, partnerName, key and value are mandatory");return}var i=y({},r,a);this.granularOptions[t]?this.granularOptions[t]=d(d({},this.granularOptions[t]),i):this.granularOptions[t]=i}},{key:"addPartnerSharingSetting",value:function(t,r,a){if(!t||!r||a===void 0){f.error("Cannot add partner sharing setting, partnerName, key and value are mandatory");return}var i=y({},r,a);this.partnerSharingSettings[t]?this.partnerSharingSettings[t]=d(d({},this.partnerSharingSettings[t]),i):this.partnerSharingSettings[t]=i}}])}();function no(e){if(!e||e.isEnabled===void 0){f.error("Can not track third-party sharing without parameters");return}var n={sharing:e.isEnabled?"enable":"disable",granularThirdPartySharingOptions:e.granularOptions,partnerSharingSettings:e.partnerSharingSettings};it({url:"/third_party_sharing",method:"POST",params:n})}var st=[];function Jn(e,n){st.push({method:e,description:n,timestamp:Date.now()})}function ro(){st.forEach(function(e){typeof e.method=="function"&&(f.log("Delayed ".concat(e.description," task is running now")),e.method(e.timestamp))}),st=[]}function ao(){st=[]}var io=10,ct="eventDeduplication";function oo(e,n){return isNaN(e)?{}:(e=parseFloat(e),e<0||!n?{}:{revenue:e.toFixed(5),currency:n})}function uo(e,n){var t=n.callbackParams,r=n.partnerParams,a={},i=d({eventToken:e.eventToken,deduplicationId:e.deduplicationId},oo(e.revenue,e.currency)),o=d(d({},ae(t)),ae(e.callbackParams)),u=d(d({},ae(r)),ae(e.partnerParams));return Y(o)||(a.callbackParams=o),Y(u)||(a.partnerParams=u),d(d({},i),a)}function so(){return S.getAll(ct).then(function(e){return e.map(function(n){return n.id})})}function co(e){var n=N.getCustomConfig().eventDeduplicationListLimit,t=n>0?n:io;return S.count(ct).then(function(r){var a=Promise.resolve();if(r>=t){var i=r-t+1;f.log("Event deduplication list limit has been reached. Oldest ids are about to be removed (".concat(i," of them)")),a=S.trimItems(ct,i)}return a}).then(function(){return f.info("New event deduplication id is added to the list: ".concat(e)),S.addItem(ct,{id:e})})}function lo(e){return e?so().then(function(n){return n.indexOf(e)===-1?co(e):Promise.reject({message:"Event won't be tracked, since it was previously tracked with the same deduplication id ".concat(e)})}):Promise.resolve()}function fo(e,n){if(!e||e&&(Y(e)||!e.eventToken)){var t="You must provide event token in order to track event";return f.error(t),Promise.reject(t)}return lo(e.deduplicationId).then(Ln).then(function(r){return it({url:"/event",method:"POST",params:uo(e,r)},{timestamp:n})}).catch(function(r){return r&&r.message&&f.error(r.message),Promise.reject(r)})}function mo(){return window.location.search.substring(1).split("&").map(function(e){return e.split("=")}).reduce(A,{}).adjust_referrer}function vo(e){return{clickTime:Ne(),source:"web_referrer",referrer:decodeURIComponent(e)}}function Xn(e,n){var t;e?t=e:t=mo(),t&&it({url:"/sdk_click",method:"POST",params:vo(t)},{timestamp:n})}var go=["logLevel","logOutput"],Pe=null,lt=!1,Le=!1,ft=!1;function po(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.logLevel,t=e.logOutput,r=cr(e,go);if(f.setLogLevel(n,t),Fe()){f.error("You already initiated your instance");return}N.hasMissing(r)||(lt=!0,S.init(r.namespace).then(function(a){if(a.type===ge.NO_STORAGE){f.error("Adjust SDK can not start, there is no storage available");return}f.info("Available storage is ".concat(a.type)),Pe=d({},r),Ht(r)}))}function ho(){return B("get attribution",function(){return g.getAttribution()})}function yo(){return B("get attribution",function(){return g.waitForAttribution()},{schedule:!1})}function bo(){return B("get web_uuid",function(){return g.getWebUUID()})}function _o(){return B("get web_uuid",function(){return g.waitForWebUUID()},{schedule:!1})}function So(e){if(!e||typeof e!="string"){f.error("You must provide a string referrer");return}B("setting reftag",function(n){return Xn(e,n)},{schedule:!0,waitForInitFinished:!0,optionalInit:!0})}function ko(e){return qo(e)}function Po(e){B("add global callback parameters",function(){return Fn(e,"callback")})}function wo(e){B("add global partner parameters",function(){return Fn(e,"partner")})}function Io(e){B("remove global callback parameter",function(){return Mn(e,"callback")})}function Do(e){B("remove global partner parameter",function(){return Mn(e,"partner")})}function Eo(){B("remove all global callback parameters",function(){return qn("callback")})}function Oo(){B("remove all global partner parameters",function(){return qn("partner")})}function Ro(){B("set offline mode",function(){return Bn(!0)})}function Ao(){B("set online mode",function(){return Bn(!1)})}function Co(){var e=Mt();e&&N.isInitialised()&&Me()}function xo(){var e=Si();e&&Pe&&Ht(Pe)}function No(){var e=$n();e&&(e=Qi(),e&&N.isInitialised()&&Vt())}function To(){Qn({isEnabled:!1})}function Qn(e){var n=function(){return g.waitForWebUUID().then(function(){return no(e)})};B("third-party sharing",n,{schedule:!1,optionalInit:!0})}function jo(){f.error("function `initSmartBanner` is deprecated")}function Bo(){f.error("function `showSmartBanner` is deprecated")}function Uo(){f.error("function `hideSmartBanner` is deprecated")}function Lo(){Z()==="paused"&&(Yi(),Promise.all([Di(),Bi(),Ti()]).then(Yn))}function Fe(){return lt||N.isInitialised()}function Vt(){lt=!1,Le=!1,ao(),ji(),Li(),Xi()}function Me(e){e&&f.log("Adjust SDK has been shutdown due to asynchronous disable"),Vt(),Zr(),Ei(),di(),S.destroy(),N.destroy()}function Yn(){ft=!1,Me(),eo(),Pe=null,f.log("Adjust SDK instance has been destroyed")}function Fo(e){f.log("Adjust SDK is starting with web_uuid set to ".concat(e.uuid));var n=g.current.installed;Zi();var t=Z(),r=function(i){return"Adjust SDK start has been interrupted ".concat(i)};return t==="off"?(Me(),Promise.reject({interrupted:!0,message:r("due to complete async disable")})):t==="paused"?(Vt(),Promise.reject({interrupted:!0,message:r("due to partial async disable")})):Le?Promise.reject({interrupted:!0,message:r("due to multiple synchronous start attempt")}):(ot({cleanUp:!0}),Ui().then(function(){lt=!1,Le=!0,n&&Zn()}))}function Zn(){ft=!0,ro(),Yr("sdk:installed")}function Mo(e){if(e.interrupted){f.log(e.message);return}if(Me(),f.error("Adjust SDK start has been canceled due to an error",e),e.stack)throw e}function Ht(e){if(Z()==="off"){f.log("Adjust SDK is disabled, can not start the sdk");return}N.set(e),ci(),ne("sdk:installed",Zn),ne("sdk:shutdown",function(){return Me(!0)}),ne("sdk:gdpr-forget-me",Lo),ne("attribution:check",function(n,t){return Ji(t)}),typeof e.attributionCallback=="function"&&ne("attribution:change",e.attributionCallback),wi().then(Fo).then(Xn).catch(Mo)}function qo(e){if(S.getType()===ge.NO_STORAGE){var n="Adjust SDK can not track event, no storage available";return f.log(n),Promise.reject(n)}if(Z()!=="on"){var t="Adjust SDK is disabled, can not track event";return f.log(t),Promise.reject(t)}if(!Fe()){var r="Adjust SDK can not track event, sdk instance is not initialized";return f.error(r),Promise.reject(r)}return new Promise(function(a){var i=function(u){return a(fo(e,u))};!ft||!Le&&Fe()?(Jn(i,"track event"),f.log("Running track event is delayed until Adjust SDK is up")):i()})}function B(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=t.schedule,a=t.waitForInitFinished,i=t.optionalInit;if(S.getType()===ge.NO_STORAGE){f.log("Adjust SDK can not ".concat(e,", no storage available"));return}if(Z()!=="on"){f.log("Adjust SDK is disabled, can not ".concat(e));return}if(!(i||Fe())&&a){f.error("Adjust SDK can not ".concat(e,", sdk instance is not initialized"));return}if(typeof n=="function")if(r&&!(ft&&Le)&&(i||Fe()))Jn(n,e),f.log("Running ".concat(e," is delayed until Adjust SDK is up"));else return n()}function Go(){return S.deleteDatabase()}function Ko(){f.log("Adjust SDK has been restarted due to asynchronous enable"),Pe&&Ht(Pe)}var Wo={initSdk:po,getAttribution:ho,getWebUUID:bo,waitForAttribution:yo,waitForWebUUID:_o,setReferrer:So,trackEvent:ko,addGlobalCallbackParameters:Po,addGlobalPartnerParameters:wo,removeGlobalCallbackParameter:Io,removeGlobalPartnerParameter:Do,clearGlobalCallbackParameters:Eo,clearGlobalPartnerParameters:Oo,switchToOfflineMode:Ro,switchBackToOnlineMode:Ao,stop:Co,restart:xo,gdprForgetMe:No,disableThirdPartySharing:To,trackThirdPartySharing:Qn,ThirdPartySharing:to,initSmartBanner:jo,showSmartBanner:Bo,hideSmartBanner:Uo,__testonly__:{destroy:Yn,clearDatabase:Go},__internal__:{restartAfterAsyncEnable:Ko}};const er=Wo;return Ie=Ie.default,Ie})())})(or);var tu=or.exports;export{tu as a,Zo as c,eu as g};
