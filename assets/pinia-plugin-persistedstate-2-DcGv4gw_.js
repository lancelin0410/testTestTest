function N(i,t,u){return(i=(t.split?t.split("."):t).reduce(function(o,n){return o&&o[n]},i))===void 0?u:i}function v(i,t,u,o){return(t=t.split?t.split("."):t.slice(0)).slice(0,-1).reduce(function(n,f){return/^(__proto__|constructor|prototype)$/.test(f)?{}:n[f]=n[f]||{}},i)[t.pop()]=u,i}function I(i,t){return i==null?t:i}function c(i,t,u,o){return I(I(u[t],o[t]),i)}function E(i){const t=i||{};function u(o){const n=function(){try{return o.options.persistedState||{}}catch(e){return{}}}();if(c(!0,"persist",n,t)===!1)return;const f=c(o.store.$id,"key",n,{}),S=c(!1,"overwrite",n,t),m=c(function(){try{return window.localStorage}catch(e){return{getItem:function(){},setItem:function(){},removeItem:function(){}}}}(),"storage",n,t),w=c(function(){return!0},"filter",n,t),h=c(JSON.stringify,"serialize",n,t),y=c(JSON.parse,"deserialize",n,t),A=c(function(e){return e},"migrate",n,{}),_=c(function(e,r){return r},"merge",n,{}),O=c(function(e){const r="@@",s=e.setItem(r,"1"),a=function(){e.removeItem(r)};s instanceof Promise?s.then(a):a()},"assertStorage",n,t);function g(e){(n.beforeHydrate||function(){})(o.store.$state);const r=_(o.store.$state,e);S?o.store.$state=r:o.store.$patch(r),l()}function $(e){if(e!=null){const r=y(e),s=A(r);s instanceof Promise?s.then(g):g(s)}else l()}let l;const b=new Promise(function(e){l=e});let d=0;o.store.$persistedState={isReady:function(){return b},pending:!1};try{x()}catch(e){l()}function x(){const e=m.getItem(f);e instanceof Promise?e.then($):$(e)}const z=function(e,r){if(w(e,r)===!1)return;Array.isArray(n.includePaths)&&(r=n.includePaths.reduce(function(p,P){return v(p,P,N(r,P,void 0))},{})),Array.isArray(n.excludePaths)&&(r=y(h(r)),n.excludePaths.forEach(function(p){return v(r,p,void 0)},{}));const s=h(r),a=m.setItem(f,s);a instanceof Promise&&(++d,o.store.$persistedState.pending=d!==0,a.catch(function(){}).finally(function(){--d,o.store.$persistedState.pending=d!==0}))};o.store.$subscribe(z)}return u}export{E as R};
