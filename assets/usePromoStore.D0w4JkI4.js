import{ab as t,g as i,a as e,O as n,T as a}from"./index-D6FzdE0N.js";import{g as s,h as o,i as r}from"./promo.Dw5aP2qH.js";import{g as c}from"./date-formatter.WRZnbcvu.js";const l="APP_PROMO_JILI_STORE_KEY",d=t({id:"promo",state:()=>({promoList:[],promoPopupList:[],community:{content:{},rewordBonus:0,joinNowLink:""},jili:{canGet:0,giftCode:null,title:"",content:{},gameList:[]},signup:{title:"",content:{}},betrankList:[],firstdepositList:[],inviterank:{title:"",content:{},tabIndex:0,rulsTabIndex:0,teamTabIndex:0,startTime:"",endTime:"",isActivityEnd:!0,uptoRewards:0,topRewards:0},turnplate:{isOpen:!1,isNew:!1,id:0,tabIndex:0,totalRemainTimes:0,remainTimes:0,title:"",content:{},spinList:[],rules:[],activityRewardList:[]}}),getters:{isShowTurnplate:t=>t.turnplate.isOpen&&t.turnplate.isNew||t.turnplate.totalRemainTimes>0},actions:{async getPromoList(){const{code:t,data:n}=await s();if(200!==t||!n)return[];const a=(new Date).getTime();let o=n.filter((t=>{let i=new Date(t.validBeginTime.replace(/-/g,"/")).getTime(),e=new Date(t.validEndTime.replace(/-/g,"/")).getTime();return i<a&&e>a}));const r=i();o=o.filter(((t,i)=>"module:bigvip"!==t.jumpUrl||!(r.serviceInfo.dedicatedCS>0||r.vipInfo.vipLevel<r.minVipLevel)));let c=[];var l;o.forEach((t=>{if(t.content){const i=JSON.parse(t.content);t.content=i,i.popup&&c.push(i)}})),l="window_sort",c.sort((function(t,i){return Number(t[l])-Number(i[l])})),c.forEach((t=>{if("firstdeposit"==t.popup){let i=[];t.recharge_items.forEach((t=>{i.push({amount:t[0],reward:t[2]})})),this.firstdepositList=i}if("betrank"==t.popup){let i=[];console.log("betrank",t.ranks[0],t.ranks[1],t.ranks[2]),t.ranks[0].rank_awards.forEach(((e,n)=>{let a={rank:"",day:"",week:"",month:""};e[0]==e[1]?a.rank=e[0]:a.rank=e[0]+"-"+e[1],a.day=e[2],a.week=t.ranks[1].rank_awards[n][2],a.month=t.ranks[2].rank_awards[n][2],i.push(a)})),this.betrankList=i}t.popup,t.popup}));const d=o.find((t=>"module:community"===t.jumpUrl));if(d&&d.content){const t=d.content;this.community.content=t,this.community.rewordBonus=t.bonus||0,this.community.joinNowLink=t.customer_service||""}const p=n.find((t=>"module:task"===t.jumpUrl));p&&p.content&&(this.signup.title=p.name,this.signup.content=p.content,this.signup.descList=p.content.tasks);const m=o.find((t=>"module:jilipromo"===t.jumpUrl));m&&m.content&&(m.content,this.jili.title=m.name||"",this.jili.content=m.content,this.jili.gameList=m.content.games||[]);const u=o.find((t=>"module:spin"===t.jumpUrl));u&&u.content&&(u.content,this.turnplate.title=u.name||"",this.turnplate.content=u.content,this.turnplate.spinList=u.content.spin_award||[],this.turnplate.rules=u.content.desc||[],this.turnplate.id=u.id,this.turnplate.isOpen=!0,this.getSpinActivityData());const h=o.find((t=>"module:inviterank"===t.jumpUrl));if(h&&h.content){const t=h.content;if(t&&t.config){if(t.config.forEach((t=>{const i=t.rank_range[0],e=t.rank_range[1];t.rankRangeShow=i===e?i:`${i}-${e}`})),t.headConfig&&t.headConfig.length){const i=t.headConfig[t.headConfig.length-1].award;this.inviterank.uptoRewards=i/t.headAwardInviteCount}t.config&&t.config.length&&(this.inviterank.topRewards=t.config[0].award)}this.inviterank.title=h.name||"",this.inviterank.content=t,this.inviterank.startTime=h.validBeginTime||"",this.inviterank.endTime=h.validEndTime||"";const i=(new Date).getTime(),e=new Date(this.inviterank.endTime).getTime();this.inviterank.isActivityEnd=i>e}if("+91"===e().phoneNumberPrefix&&m){const t=await this.getCanGiftCode();t&&(c=[t].concat(c))}return o=o.filter(((t,i)=>0!=t.displayType)),this.promoPopupList=c,this.promoList=o,o},async getCanGiftCode(){const{code:t,data:i}=await o({claimCode:0});if(200!==t||!i)return null;this.jili.canGet=i.canGet||0,this.jili.giftCode=i.giftCode||"";const e=n(l),a=c(8);return e&&e===a?null:1===i.canGet&&i.giftCode?{popup:"giftCode",canGet:this.jili.canGet,giftCode:this.jili.giftCode}:null},async getGiftCode(){const{code:t,data:i}=await o({claimCode:1});return 200===t&&i?(this.jili.canGet=i.canGet||0,this.jili.giftCode=i.giftCode||"",!0):null},setJiliNoShowToday(){const t=c(8);a(l,t)},async getSpinActivityData(){const{code:t,data:i}=await r();if(200!==t)return null;this.turnplate.activityRewardList=i||[];let e=0,n=!1;return this.turnplate.activityRewardList.forEach((t=>{e+=t.remainTimes,0===t.finishStatus&&0===t.remainTimes&&(n=!0)})),this.turnplate.isNew=n,this.turnplate.totalRemainTimes=e,!0}}});export{d as u};
